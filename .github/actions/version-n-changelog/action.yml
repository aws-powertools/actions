name: 'Version and Changelog Generator'
description: 'Generates version and changelog using bump-n-go'
inputs:
  release-type:
    description: 'The type of release to create (major, minor, patch). If not specified, bump-n-go will determine automatically.'
    required: false
  dry-run:
    description: 'Run in dry-run mode without making changes'
    required: false
    default: 'false'
outputs:
  new-version:
    description: 'The new version generated by bump-n-go'
    value: ${{ steps.bump-version.outputs.new_version }}
runs:
  using: "composite"
  steps:
    - name: "Setup Node.js"
      uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f # v6.1.0
      with:
        node-version: "24"
        cache: "npm"
    - name: Setup dependencies
      shell: bash
      run: |
        # Install dependencies from the action's directory
        npm ci --prefix ${{ github.action_path }}
    - name: Run bump-n-go
      id: bump-version
      shell: bash
      run: |
        # Build CLI arguments
        CMD_ARGS=""
        
        # Add release-type only if specified
        if [[ -n "${{ inputs.release-type }}" && "${{ inputs.release-type }}" != "auto" ]]; then
            CMD_ARGS="--type ${{ inputs.release-type }}"
        fi
        
        # Add dry-run flag if enabled
        if [[ "${{ inputs.dry-run }}" == "true" ]]; then
          if [[ -n "$CMD_ARGS" ]]; then
            CMD_ARGS="$CMD_ARGS --dry-run"
          else
            CMD_ARGS="--dry-run"
          fi
        fi

        # Add verbose flag if GitHub Actions is running with debug logging enabled
        if [[ -n "$RUNNER_DEBUG" ]]; then
            CMD_ARGS="$CMD_ARGS --verbose"
        fi
        
        # Run bump-n-go with the constructed arguments
        npx bump-n-go $CMD_ARGS
